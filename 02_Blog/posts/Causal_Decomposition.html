<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kentaro Kamada">
<meta name="dcterms.date" content="2024-02-22">

<title>Causal Decomposition Analysis – Kentaro Kamada</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Kentaro Kamada</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../00_profile.html"> 
<span class="menu-text">Profile</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../01_research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../02_Blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/Kentaro-Kamada/Kentaro-Kamada.github.io" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causal Decomposition Analysis</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Causal Inference</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kentaro Kamada </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 22, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#前準備" id="toc-前準備" class="nav-link active" data-scroll-target="#前準備">前準備</a></li>
  <li><a href="#continuuous-mediator" id="toc-continuuous-mediator" class="nav-link" data-scroll-target="#continuuous-mediator">continuuous mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp" id="toc-cfdecomp" class="nav-link" data-scroll-target="#cfdecomp"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp" id="toc-causal.decomp" class="nav-link" data-scroll-target="#causal.decomp"><code>causal.decomp</code></a></li>
  </ul></li>
  <li><a href="#binary-mediator" id="toc-binary-mediator" class="nav-link" data-scroll-target="#binary-mediator">binary mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp-1" id="toc-cfdecomp-1" class="nav-link" data-scroll-target="#cfdecomp-1"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp-1" id="toc-causal.decomp-1" class="nav-link" data-scroll-target="#causal.decomp-1"><code>causal.decomp</code></a></li>
  <li><a href="#gapclosing" id="toc-gapclosing" class="nav-link" data-scroll-target="#gapclosing"><code>gapclosing</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="前準備" class="level2">
<h2 class="anchored" data-anchor-id="前準備">前準備</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cfdecomp)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapclosing)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causal.decomp)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  sMIDUS <span class="sc">|&gt;</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">Y =</span> health <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),  <span class="co"># outcome</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">T =</span> edu <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),   <span class="co"># treatment (continuous)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">T2 =</span> edu <span class="sc">|&gt;</span> <span class="fu">case_match</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">~</span> <span class="dv">0</span>,   <span class="co"># treatment (binary)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">.default =</span> <span class="cn">NA</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">X =</span> racesex <span class="sc">|&gt;</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"4"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)),  <span class="co"># note!</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">L1 =</span> lowchildSES <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">L2 =</span> abuse <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">C1 =</span> age <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">C2 =</span> stroke <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">C3 =</span> T2DM <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">C4 =</span> heart <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(L1<span class="sc">:</span>C4, \(.x){.x <span class="sc">-</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})) <span class="sc">|&gt;</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="continuuous-mediator" class="level1">
<h1>continuuous mediator</h1>
<section id="cfdecomp" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp"><code>cfdecomp</code></h2>
<ul>
<li><span class="citation" data-cites="Sudharsanan2021">Sudharsanan and Bijlsma (<a href="#ref-Sudharsanan2021" role="doc-biblioref">2021</a>)</span> の方法。mediatorの値をシミュレーションで複数生成するのが特徴</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  cfdecomp<span class="sc">::</span><span class="fu">cfd.mean</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T + X:T + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$out_nc_m
          1        4        2        3
1  7.731789 5.805505 7.066859 6.349031
2  7.707226 5.843033 7.070471 6.485656
3  7.698774 5.821902 7.062534 6.375884
4  7.691470 5.865455 7.099146 6.303865
5  7.688225 5.836683 7.054470 6.312770
6  7.723805 5.803500 7.068066 6.444975
7  7.698415 5.870867 7.062609 6.386744
8  7.699978 5.933884 7.057151 6.402836
9  7.710907 5.845157 7.059609 6.461985
10 7.708696 5.950518 7.081765 6.478036
11 7.686202 5.955810 7.077234 6.504364
12 7.669373 5.879307 7.048990 6.403341
13 7.710189 5.911726 7.074698 6.387250
14 7.688763 5.840438 7.105175 6.406841
15 7.708662 5.863814 7.074277 6.360935
16 7.702557 5.886883 7.082974 6.381459
17 7.720214 5.875628 7.092283 6.553809
18 7.734196 5.847053 7.088655 6.312337
19 7.726682 5.844651 7.113512 6.447178
20 7.662551 5.897172 7.094152 6.408982
21 7.687241 5.806254 7.097668 6.356683
22 7.706224 5.821863 7.054051 6.433060
23 7.741596 5.801439 7.062559 6.392707
24 7.674205 5.894450 7.081670 6.385270
25 7.709742 5.799705 7.114933 6.466543
26 7.716565 5.906480 7.070636 6.382427
27 7.742944 5.859867 7.061948 6.401316
28 7.717200 5.890989 7.097299 6.409356
29 7.723915 5.868337 7.071758 6.372131
30 7.726668 5.881568 7.100313 6.372692
31 7.731705 5.919737 7.105135 6.373668
32 7.712671 5.839134 7.088908 6.460836
33 7.682584 5.857658 7.062899 6.533219
34 7.691469 5.835281 7.090124 6.398250
35 7.743882 5.871340 7.064668 6.419700
36 7.713512 5.902022 7.118880 6.411312
37 7.693975 5.942511 7.065955 6.404655
38 7.697669 5.849695 7.099616 6.396220
39 7.691657 5.886817 7.068964 6.244611
40 7.681820 5.871839 7.087398 6.434817
41 7.718626 5.877690 7.066733 6.400651
42 7.709633 5.861919 7.046760 6.351833
43 7.736185 5.912152 7.092974 6.424599
44 7.705218 5.879939 7.054936 6.350873
45 7.683444 5.900607 7.072793 6.430105
46 7.719582 5.888390 7.092494 6.473278
47 7.681407 5.883261 7.095664 6.423728
48 7.696037 5.844135 7.091612 6.329174
49 7.702683 5.891098 7.101262 6.381780
50 7.720314 5.916573 7.092069 6.310055

$out_cf_m
          1        4        2        3
1  7.719913 7.746320 7.728786 7.699058
2  7.678215 7.694068 7.693180 7.665525
3  7.699434 7.725147 7.722325 7.696981
4  7.676104 7.727642 7.696774 7.647236
5  7.692116 7.709129 7.696729 7.674762
6  7.731730 7.727295 7.750164 7.699577
7  7.704540 7.714182 7.719238 7.698657
8  7.709604 7.716467 7.729127 7.701963
9  7.714103 7.718377 7.729895 7.684083
10 7.707093 7.698710 7.712935 7.672843
11 7.680038 7.702717 7.700398 7.668603
12 7.677552 7.677258 7.678370 7.662850
13 7.701106 7.722790 7.730619 7.741173
14 7.692373 7.693829 7.705447 7.669664
15 7.711272 7.714818 7.705975 7.707794
16 7.726449 7.746166 7.711053 7.709945
17 7.722831 7.707959 7.733351 7.733453
18 7.731768 7.723379 7.739136 7.668382
19 7.745723 7.733054 7.751725 7.755856
20 7.671000 7.679469 7.655867 7.626149
21 7.702213 7.734704 7.725656 7.680785
22 7.707144 7.742190 7.727008 7.716613
23 7.729849 7.738835 7.742313 7.685720
24 7.685653 7.711574 7.699772 7.670258
25 7.710139 7.747027 7.736181 7.697113
26 7.709258 7.705371 7.718198 7.673312
27 7.753493 7.755348 7.758776 7.757045
28 7.739015 7.718246 7.720594 7.715022
29 7.716218 7.724317 7.713021 7.700595
30 7.711303 7.727521 7.713654 7.696233
31 7.760813 7.742986 7.748841 7.746770
32 7.716122 7.710385 7.722291 7.696317
33 7.693466 7.662975 7.679297 7.709346
34 7.683647 7.689322 7.686074 7.703252
35 7.744599 7.741218 7.750546 7.724121
36 7.697419 7.685222 7.724294 7.692201
37 7.700813 7.740795 7.713151 7.696126
38 7.676711 7.680532 7.706335 7.671492
39 7.690267 7.654816 7.691495 7.633795
40 7.676736 7.694828 7.691697 7.692020
41 7.712844 7.741225 7.715984 7.724711
42 7.718374 7.729696 7.734668 7.725327
43 7.736461 7.745641 7.754585 7.720189
44 7.694301 7.703422 7.717384 7.646946
45 7.692242 7.692127 7.684788 7.666741
46 7.735225 7.711455 7.735495 7.745750
47 7.681518 7.720674 7.699393 7.694490
48 7.694283 7.686017 7.721461 7.692578
49 7.711065 7.713413 7.716224 7.728340
50 7.722788 7.733545 7.729447 7.682326

$out_nc_quantile_m
             1        4        2        3
2.5%  7.670460 5.801903 7.050129 6.305258
50%   7.707944 5.871590 7.079452 6.400983
97.5% 7.742641 5.948717 7.114614 6.526726

$out_cf_quantile_m
             1        4        2        3
2.5%  7.676241 7.666189 7.678578 7.636754
50%   7.708201 7.717356 7.718718 7.696275
97.5% 7.751745 7.746868 7.753942 7.753812

$out_nc_y
          1        4        2        3
1  7.654354 6.726877 7.279371 7.006732
2  7.604374 6.703217 7.315085 7.097881
3  7.605167 6.640730 7.292927 7.048538
4  7.609123 6.686366 7.323191 6.849639
5  7.577872 6.763536 7.318662 6.942950
6  7.587875 6.683869 7.348530 6.897409
7  7.596512 6.736657 7.297214 7.017636
8  7.597459 6.706974 7.365672 7.009930
9  7.584375 6.740994 7.313201 7.063046
10 7.602285 6.749087 7.328256 7.125055
11 7.571613 6.701864 7.287344 7.027034
12 7.642267 6.679553 7.348553 6.990542
13 7.579927 6.759528 7.302936 7.048694
14 7.561756 6.662268 7.324979 7.032725
15 7.609795 6.692728 7.303105 6.986432
16 7.606684 6.733055 7.290687 7.005327
17 7.596875 6.687174 7.301648 7.018505
18 7.615286 6.712333 7.293161 6.975195
19 7.611216 6.714235 7.318400 7.103140
20 7.610244 6.719374 7.305010 7.000470
21 7.620159 6.733937 7.357554 6.972791
22 7.596723 6.712167 7.345405 7.021319
23 7.617759 6.661849 7.308262 6.971760
24 7.579323 6.658994 7.307253 6.996847
25 7.574397 6.681958 7.335591 6.944247
26 7.612435 6.745267 7.350639 7.024679
27 7.579164 6.709612 7.295948 6.949603
28 7.584462 6.700136 7.287569 6.990432
29 7.624832 6.701683 7.340434 6.948277
30 7.629350 6.749253 7.352669 6.997115
31 7.615771 6.689698 7.304085 7.004110
32 7.624198 6.680530 7.324006 6.888503
33 7.591139 6.631380 7.336246 7.108249
34 7.596286 6.698941 7.318825 7.032162
35 7.587954 6.669535 7.333915 6.948089
36 7.639479 6.733325 7.347933 7.023281
37 7.606131 6.800760 7.304337 6.976923
38 7.555995 6.682133 7.313927 6.983365
39 7.612931 6.717997 7.305366 6.775258
40 7.539498 6.773797 7.326341 7.022486
41 7.633821 6.692777 7.300170 7.072764
42 7.613440 6.671418 7.343165 7.002534
43 7.589947 6.730775 7.335019 6.982015
44 7.580244 6.673911 7.318004 7.007913
45 7.612123 6.772801 7.326254 6.918901
46 7.598858 6.675470 7.327589 7.099497
47 7.571266 6.728050 7.312118 6.924836
48 7.633511 6.633413 7.316639 6.917330
49 7.565143 6.713109 7.333032 6.933765
50 7.597296 6.769629 7.359050 6.870460

$out_cf_y
          1        4        2        3
1  7.651580 7.280327 7.433407 7.148336
2  7.598316 7.364480 7.462969 7.513760
3  7.605259 7.300873 7.445011 7.280079
4  7.605265 7.220335 7.447280 7.444796
5  7.578768 7.313775 7.455726 7.287270
6  7.589536 7.333158 7.529055 7.181668
7  7.597940 7.159310 7.431304 7.407380
8  7.600139 7.238519 7.520944 7.347962
9  7.585226 7.238013 7.467420 7.206755
10 7.601882 7.204490 7.467875 7.349244
11 7.570062 7.310320 7.417403 7.246240
12 7.644254 7.295837 7.497083 7.402857
13 7.578033 7.218928 7.431563 7.332764
14 7.562771 7.188282 7.458223 7.190563
15 7.610323 7.046494 7.421189 7.233469
16 7.612510 7.308954 7.415157 7.429157
17 7.597392 7.254821 7.428926 7.263213
18 7.614863 7.212235 7.469477 7.093990
19 7.615121 7.226062 7.488663 7.230689
20 7.612024 7.290666 7.406780 7.188714
21 7.623698 7.311562 7.510014 7.236440
22 7.596961 7.348498 7.463619 7.334002
23 7.615365 7.455319 7.460632 7.417265
24 7.581550 7.019159 7.436448 7.225535
25 7.574483 7.212054 7.452269 7.177630
26 7.610472 7.277957 7.454000 7.302071
27 7.581687 7.217582 7.480976 7.242596
28 7.590178 7.222412 7.431234 7.331709
29 7.622939 7.366921 7.480330 7.235731
30 7.625461 7.364106 7.487113 7.355902
31 7.622096 7.199349 7.465602 7.253736
32 7.624942 7.355884 7.447775 7.055203
33 7.593184 7.246195 7.456345 7.206748
34 7.594305 7.205120 7.450068 7.272635
35 7.588149 7.245190 7.505413 7.014219
36 7.635373 7.277123 7.451057 7.323479
37 7.607531 7.413763 7.449557 7.470978
38 7.552591 7.290708 7.443413 7.045987
39 7.612603 7.141743 7.455111 7.169168
40 7.538307 7.369341 7.465470 7.473931
41 7.632490 7.184794 7.471516 7.342080
42 7.615353 7.229403 7.450599 7.394764
43 7.590004 7.279568 7.486427 7.158535
44 7.577797 7.246399 7.476507 7.094514
45 7.614111 7.256873 7.473994 7.177816
46 7.602539 7.264906 7.485320 7.459046
47 7.571299 7.190251 7.444465 6.994557
48 7.633077 7.249494 7.479441 7.142252
49 7.567511 7.096721 7.486926 7.228220
50 7.597905 7.411709 7.460691 7.268741

$out_nc_quantile_y
             1        4        2        3
2.5%  7.557292 6.635059 7.287395 6.854324
50%   7.600571 6.705095 7.318531 6.998793
97.5% 7.641640 6.773573 7.358713 7.107100

$out_cf_quantile_y
             1        4        2        3
2.5%  7.554882 7.057795 7.415662 7.021367
50%   7.601011 7.252157 7.459427 7.249988
97.5% 7.642256 7.413301 7.518484 7.473267

$mediation
        4         2         3 
0.6182036 0.5076457 0.4483935 

$mediation_quantile
              4         2         3
2.5%  0.4045932 0.3607608 0.1081933
97.5% 0.7773249 0.6739174 0.8130188

$mc_conv_info_m
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.725375 5.833575 7.061328 6.407614
 [2,] 7.739864 5.846927 7.057499 6.373652
 [3,] 7.739435 5.830384 7.069188 6.383956
 [4,] 7.739284 5.834167 7.072495 6.378767
 [5,] 7.735722 5.823713 7.063801 6.367829
 [6,] 7.735676 5.814660 7.064555 6.359981
 [7,] 7.741011 5.813870 7.069577 6.356077
 [8,] 7.734823 5.807032 7.067207 6.357027
 [9,] 7.735733 5.808808 7.066303 6.350663
[10,] 7.731789 5.805505 7.066859 6.349031

$mc_conv_info_y
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.652856 6.734882 7.278084 7.012877
 [2,] 7.656240 6.738689 7.277193 7.009315
 [3,] 7.656140 6.733972 7.279913 7.010396
 [4,] 7.656105 6.735050 7.280683 7.009852
 [5,] 7.655273 6.732069 7.278660 7.008704
 [6,] 7.655262 6.729488 7.278835 7.007881
 [7,] 7.656508 6.729262 7.280004 7.007472
 [8,] 7.655063 6.727312 7.279453 7.007571
 [9,] 7.655275 6.727819 7.279242 7.006904
[10,] 7.654354 6.726877 7.279371 7.006732</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8922794</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3410542</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5512252</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.6182036 0.5076457 0.4483935 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2796684</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1390182</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1406502</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.609046</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.336486</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2725601</code></pre>
</div>
</div>
</section>
<section id="causal.decomp" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp"><code>causal.decomp</code></h2>
<ul>
<li><span class="citation" data-cites="Park2023a">Park, Kang, and Lee (<a href="#ref-Park2023a" role="doc-biblioref">2023</a>)</span> の方法。</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T <span class="sc">+</span> X<span class="sc">:</span>T <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">lm</span>(T <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fit_smi <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit.m =</span> fit.m,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="dv">1</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># baseline covariatesを調整できる</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#covariates = c("C1", "C2", "C3", "C4"),</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">227</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>fit_smi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                               estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.8993401   -0.9925190  -0.79813505
Disparity Remaining (1 vs 4) -0.3384430   -0.4880863  -0.14795873
Disparity Reduction (1 vs 4) -0.5608971   -0.7346168  -0.42650061
Initial Disparity   (1 vs 2) -0.2749659   -0.3378874  -0.19366549
Disparity Remaining (1 vs 2) -0.1213246   -0.2203441  -0.05458727
Disparity Reduction (1 vs 2) -0.1536412   -0.1896213  -0.10521328
Initial Disparity   (1 vs 3) -0.6137425   -0.7326095  -0.47793913
Disparity Remaining (1 vs 3) -0.3500123   -0.5151994  -0.08733348
Disparity Reduction (1 vs 3) -0.2637302   -0.4880614  -0.11574038</code></pre>
</div>
</div>
<ul>
<li>sensitivity analysis<span class="citation" data-cites="Park2023">(<a href="#ref-Park2023" role="doc-biblioref">Park et al. 2023</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi, <span class="at">fit.m =</span> fit.m, <span class="at">fit.y =</span> fit.y, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="binary-mediator" class="level1">
<h1>binary mediator</h1>
<section id="cfdecomp-1" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp-1"><code>cfdecomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b <span class="ot">&lt;-</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cfd.mean</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T2 + X:T2 + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T2 ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T2'</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'binomial'</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8981701</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5546351</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.343535</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.3828971 0.1298177 0.2061071 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2774845</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2419289</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.03555558</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5849521</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4655888</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1193632</code></pre>
</div>
</div>
</section>
<section id="causal.decomp-1" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp-1"><code>causal.decomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T2 <span class="sc">+</span> X<span class="sc">:</span>T2 <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>fit_smi_b <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fit.m =</span> fit.m,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>               <span class="co"># covariates = 1,</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>),</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">seed =</span> <span class="dv">123456</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>fit_smi_b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                                estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.95667843  -1.02938841  -0.88175003
Disparity Remaining (1 vs 4) -0.61262729  -0.77966809  -0.46844380
Disparity Reduction (1 vs 4) -0.34405113  -0.49650368  -0.21581205
Initial Disparity   (1 vs 2) -0.31394841  -0.38058533  -0.26000373
Disparity Remaining (1 vs 2) -0.27995004  -0.34624791  -0.22226331
Disparity Reduction (1 vs 2) -0.03399837  -0.05003528  -0.02022012
Initial Disparity   (1 vs 3) -0.59968604  -0.69525994  -0.49987857
Disparity Remaining (1 vs 3) -0.48148718  -0.61387973  -0.32105036
Disparity Reduction (1 vs 3) -0.11819886  -0.24676548  -0.03361808</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi_b, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.m =</span> fit.m, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.y =</span> fit.y, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T2"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gapclosing" class="level2">
<h2 class="anchored" data-anchor-id="gapclosing"><code>gapclosing</code></h2>
<ul>
<li><span class="citation" data-cites="Lundberg2022a">Lundberg (<a href="#ref-Lundberg2022a" role="doc-biblioref">2022</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - regression</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stochastic intervention</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># treatmentの割り当て確率の予測値を算出</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 全員のtreatmentが1だった時の予測値</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>assing_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_glm, <span class="at">newdata =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">X =</span> <span class="st">"1"</span>), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値をもとにrandom draw</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>draw <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>fit_gapclosing <span class="ot">&lt;-</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">*</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">counterfactual_assignments =</span> draw <span class="co"># random draw</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>機械学習をつかったdoubly robustな方法も使える</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - ranger, doubly robust</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fit_gapclosing_ranger <span class="ot">&lt;-</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">+</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_formula =</span> T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">counterfactual_assignments =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob) </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Lundberg2022a" class="csl-entry" role="listitem">
Lundberg, Ian. 2022. <span>“The <span>Gap-Closing Estimand</span>: <span>A Causal Approach</span> to <span>Study Interventions That Close Disparities Across Social Categories</span>.”</span> <em>Sociological Methods &amp; Research</em>, January. <a href="https://doi.org/10.1177/00491241211055769">https://doi.org/10.1177/00491241211055769</a>.
</div>
<div id="ref-Park2023a" class="csl-entry" role="listitem">
Park, Soojin, Suyeon Kang, and Chioun Lee. 2023. <span>“Choosing an <span>Optimal Method</span> for <span>Causal Decomposition Analysis</span> with <span>Continuous Outcomes</span>: <span>A Review</span> and <span>Simulation Study</span>.”</span> <em>Sociological Methodology</em>, July, 00811750231183711. <a href="https://doi.org/10.1177/00811750231183711">https://doi.org/10.1177/00811750231183711</a>.
</div>
<div id="ref-Park2023" class="csl-entry" role="listitem">
Park, Soojin, Suyeon Kang, Chioun Lee, and Shujie Ma. 2023. <span>“Sensitivity <span>Analysis</span> for <span>Causal Decomposition Analysis</span>: <span>Assessing Robustness Toward Omitted Variable Bias</span>.”</span> <em>Journal of Causal Inference</em> 11 (1): 20220031. <a href="https://doi.org/10.1515/jci-2022-0031">https://doi.org/10.1515/jci-2022-0031</a>.
</div>
<div id="ref-Sudharsanan2021" class="csl-entry" role="listitem">
Sudharsanan, Nikkil, and Maarten J Bijlsma. 2021. <span>“Educational <span>Note</span>: <span>Causal Decomposition</span> of <span>Population Health Differences Using Monte Carlo Integration</span> and the <span>G-Formula</span>.”</span> <em>International Journal of Epidemiology</em> 50 (6): 2098–2107. <a href="https://doi.org/10.1093/ije/dyab090">https://doi.org/10.1093/ije/dyab090</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Kentaro-Kamada\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>