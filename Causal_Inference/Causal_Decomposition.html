<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Kentaro-Kamada - Causal Decomposition Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Kentaro-Kamada</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-causal-inference" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Causal Inference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-causal-inference">    
        <li>
    <a class="dropdown-item" href="../Causal_Inference/TMLE.html">
 <span class="dropdown-text">Targeted Maximum Likelihood Estimation / Targeted Minimum Loss-based Estimation (TMLE)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Causal_Inference/L-TMLE.html">
 <span class="dropdown-text">Longitudinal TMLE</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Causal_Inference/Causal_Decomposition.html">
 <span class="dropdown-text">Causal Decomposition Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Causal_Inference/Sudharsanan_Bijlsma_2021_読解.html">
 <span class="dropdown-text">Sudharsanan_Bijlsma_2021_Educational note 読解</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-others" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Others</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-others">    
        <li>
    <a class="dropdown-item" href="../Others/rlang学習.html">
 <span class="dropdown-text">rlang学習</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Others/度数から対数尤度を計算.html">
 <span class="dropdown-text">観測度数・期待度数から対数尤度を計算する方法</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Others/Multilevel.html">
 <span class="dropdown-text">マルチレベルモデルは点推定値に影響を及ぼすか？</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Others/tensorflow_with_Rstudio.html">
 <span class="dropdown-text">tensorflowをRstudioで</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#前準備" id="toc-前準備" class="nav-link active" data-scroll-target="#前準備">前準備</a></li>
  <li><a href="#continuuous-mediator" id="toc-continuuous-mediator" class="nav-link" data-scroll-target="#continuuous-mediator">continuuous mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp" id="toc-cfdecomp" class="nav-link" data-scroll-target="#cfdecomp"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp" id="toc-causal.decomp" class="nav-link" data-scroll-target="#causal.decomp"><code>causal.decomp</code></a></li>
  </ul></li>
  <li><a href="#binary-mediator" id="toc-binary-mediator" class="nav-link" data-scroll-target="#binary-mediator">binary mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp-1" id="toc-cfdecomp-1" class="nav-link" data-scroll-target="#cfdecomp-1"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp-1" id="toc-causal.decomp-1" class="nav-link" data-scroll-target="#causal.decomp-1"><code>causal.decomp</code></a></li>
  <li><a href="#gapclosing" id="toc-gapclosing" class="nav-link" data-scroll-target="#gapclosing"><code>gapclosing</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Causal Decomposition Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="前準備" class="level2">
<h2 class="anchored" data-anchor-id="前準備">前準備</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cfdecomp)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapclosing)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causal.decomp)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  sMIDUS <span class="sc">|&gt;</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">Y =</span> health <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),  <span class="co"># outcome</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">T =</span> edu <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),   <span class="co"># treatment (continuous)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">T2 =</span> edu <span class="sc">|&gt;</span> <span class="fu">case_match</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">~</span> <span class="dv">0</span>,   <span class="co"># treatment (binary)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">.default =</span> <span class="cn">NA</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">X =</span> racesex <span class="sc">|&gt;</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"4"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)),  <span class="co"># note!</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">L1 =</span> lowchildSES <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">L2 =</span> abuse <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">C1 =</span> age <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">C2 =</span> stroke <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">C3 =</span> T2DM <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">C4 =</span> heart <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(L1<span class="sc">:</span>C4, \(.x){.x <span class="sc">-</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})) <span class="sc">|&gt;</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="continuuous-mediator" class="level1">
<h1>continuuous mediator</h1>
<section id="cfdecomp" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp"><code>cfdecomp</code></h2>
<ul>
<li><span class="citation" data-cites="Sudharsanan2021">Sudharsanan and Bijlsma (<a href="#ref-Sudharsanan2021" role="doc-biblioref">2021</a>)</span> の方法。mediatorの値をシミュレーションで複数生成するのが特徴</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  cfdecomp<span class="sc">::</span><span class="fu">cfd.mean</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T + X:T + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$out_nc_m
          1        4        2        3
1  7.704393 5.878511 7.100601 6.334574
2  7.684907 5.893482 7.078147 6.504993
3  7.667103 5.792513 7.064230 6.331297
4  7.691473 5.832407 7.094649 6.448269
5  7.702502 5.867025 7.084150 6.302879
6  7.707649 5.881564 7.073169 6.348328
7  7.698524 5.863295 7.094253 6.304080
8  7.665428 5.934105 7.077088 6.393080
9  7.687736 5.849997 7.069869 6.413267
10 7.691149 5.867068 7.097231 6.395584
11 7.717062 5.875149 7.083784 6.311631
12 7.714051 5.841621 7.081830 6.427463
13 7.720328 5.865250 7.084813 6.451981
14 7.716165 5.781157 7.065282 6.483936
15 7.701326 5.931750 7.110469 6.480753
16 7.713160 5.909803 7.113075 6.471447
17 7.717832 5.793296 7.100073 6.395649
18 7.721109 5.873599 7.059873 6.346348
19 7.706348 5.847319 7.067505 6.412451
20 7.711646 5.830050 7.082999 6.401420
21 7.692526 5.825116 7.072620 6.470432
22 7.720256 5.818086 7.109367 6.362887
23 7.687258 5.858049 7.071935 6.427542
24 7.779983 5.917717 7.064179 6.440181
25 7.687712 5.880672 7.070538 6.392827
26 7.681760 5.874938 7.072690 6.387883
27 7.723142 5.922137 7.074596 6.458075
28 7.745995 5.868351 7.109323 6.394674
29 7.675111 5.874267 7.080646 6.400481
30 7.704231 5.869453 7.084789 6.438085
31 7.703909 5.828574 7.069695 6.400884
32 7.723633 5.923871 7.101306 6.442652
33 7.704270 5.940003 7.073209 6.348928
34 7.690021 5.863546 7.141164 6.350132
35 7.713714 5.935156 7.068561 6.379914
36 7.701639 5.803481 7.090905 6.380944
37 7.663258 5.898129 7.065360 6.451323
38 7.700254 5.880185 7.038593 6.495530
39 7.740043 5.857458 7.052444 6.229921
40 7.675637 5.903854 7.053284 6.370314
41 7.720521 5.804465 7.127913 6.454960
42 7.722971 5.832164 7.059062 6.404134
43 7.718257 5.865445 7.110773 6.377804
44 7.710481 5.916549 7.056362 6.351512
45 7.693268 5.862944 7.063951 6.447388
46 7.678086 5.846925 7.073370 6.380035
47 7.723755 5.911177 7.075948 6.456036
48 7.677894 5.949973 7.048513 6.405711
49 7.718471 5.880965 7.061658 6.505462
50 7.676996 5.882907 7.099679 6.596813

$out_cf_m
          1        4        2        3
1  7.695237 7.698664 7.714275 7.698376
2  7.692037 7.735170 7.708061 7.714884
3  7.662060 7.669484 7.678900 7.629026
4  7.692625 7.730004 7.692944 7.727442
5  7.703100 7.676401 7.707583 7.680340
6  7.692301 7.704222 7.711041 7.705918
7  7.694546 7.747794 7.717056 7.698930
8  7.662324 7.658380 7.681429 7.643902
9  7.672684 7.694050 7.695842 7.699512
10 7.666396 7.665698 7.676986 7.634029
11 7.731539 7.728737 7.725253 7.689596
12 7.718414 7.677185 7.721105 7.718532
13 7.727804 7.725323 7.732888 7.713343
14 7.700645 7.691775 7.700034 7.693086
15 7.693895 7.700015 7.690966 7.660751
16 7.705284 7.730238 7.701869 7.703176
17 7.715922 7.735389 7.729652 7.730373
18 7.729834 7.708581 7.740596 7.716448
19 7.727479 7.681980 7.725371 7.715341
20 7.718810 7.699963 7.723112 7.709143
21 7.690483 7.710145 7.714376 7.704448
22 7.710002 7.708093 7.729129 7.701050
23 7.676221 7.676947 7.689312 7.657328
24 7.786247 7.790737 7.794220 7.774169
25 7.686563 7.700556 7.700895 7.692829
26 7.685353 7.692371 7.698384 7.675953
27 7.725504 7.745133 7.735270 7.716700
28 7.747605 7.728458 7.759898 7.731043
29 7.679783 7.643081 7.686112 7.665649
30 7.704130 7.699832 7.720783 7.721398
31 7.701701 7.710872 7.713634 7.678175
32 7.735713 7.726618 7.730834 7.721670
33 7.696643 7.697963 7.702217 7.712556
34 7.704079 7.707784 7.701126 7.679178
35 7.716738 7.713484 7.721166 7.720744
36 7.702610 7.693181 7.710453 7.682322
37 7.686079 7.703241 7.703538 7.694242
38 7.695140 7.706969 7.701521 7.704428
39 7.726793 7.741675 7.727676 7.697694
40 7.670291 7.660500 7.683376 7.666899
41 7.713675 7.707159 7.724040 7.713228
42 7.723779 7.761976 7.739969 7.705372
43 7.712476 7.713428 7.715712 7.685084
44 7.704671 7.722937 7.717555 7.698043
45 7.684617 7.724854 7.705855 7.684188
46 7.700869 7.696082 7.695639 7.658616
47 7.735210 7.731111 7.732692 7.722269
48 7.690006 7.728187 7.703978 7.687452
49 7.710897 7.730958 7.717505 7.715660
50 7.684738 7.694305 7.692742 7.681102

$out_nc_quantile_m
             1        4        2        3
2.5%  7.665805 5.792689 7.049397 6.303149
50%   7.704251 5.868902 7.075272 6.401152
97.5% 7.744656 5.938913 7.124575 6.505357

$out_cf_quantile_m
             1        4        2        3
2.5%  7.663240 7.658857 7.679469 7.636250
50%   7.702156 7.707471 7.712338 7.699221
97.5% 7.744930 7.758785 7.755555 7.730893

$out_nc_y
          1        4        2        3
1  7.609364 6.718684 7.341827 7.002085
2  7.628486 6.719177 7.294239 7.052794
3  7.595029 6.716448 7.336332 6.978392
4  7.636489 6.711188 7.305312 6.893564
5  7.579541 6.660990 7.316580 6.975759
6  7.580596 6.700170 7.288052 6.998277
7  7.595183 6.711373 7.332799 7.012144
8  7.551420 6.644580 7.306586 7.013259
9  7.582326 6.707404 7.296872 6.987075
10 7.589799 6.677915 7.328206 6.971000
11 7.614199 6.720911 7.339720 6.868702
12 7.586114 6.689092 7.351506 7.026881
13 7.622678 6.682343 7.325961 6.977455
14 7.603960 6.650643 7.338078 7.110627
15 7.579252 6.724402 7.317658 6.975170
16 7.611930 6.774817 7.335448 6.945007
17 7.585327 6.647768 7.341476 6.935480
18 7.576620 6.666223 7.322488 6.842111
19 7.575377 6.692609 7.320514 7.008304
20 7.642213 6.704353 7.360568 6.919576
21 7.578390 6.697662 7.305599 7.009812
22 7.623193 6.667674 7.323701 6.975625
23 7.603659 6.720316 7.327473 6.977863
24 7.624144 6.785678 7.330341 6.934198
25 7.591184 6.740607 7.296366 7.087310
26 7.580709 6.697542 7.305766 6.971515
27 7.596846 6.736814 7.309232 6.977437
28 7.626346 6.705490 7.365605 6.953224
29 7.588795 6.682027 7.350720 7.021670
30 7.598572 6.671137 7.332563 7.050782
31 7.663353 6.674185 7.316531 6.956455
32 7.638913 6.654991 7.315467 6.943161
33 7.583040 6.744792 7.315880 7.050680
34 7.587131 6.745807 7.315240 7.040534
35 7.629869 6.777861 7.320697 6.987942
36 7.633211 6.690888 7.296936 7.042209
37 7.586876 6.690698 7.304879 7.001249
38 7.605630 6.641577 7.312473 7.054762
39 7.578209 6.702098 7.346856 6.861277
40 7.615791 6.693407 7.275010 6.904633
41 7.619558 6.629054 7.335635 6.968320
42 7.597071 6.722200 7.301024 6.909407
43 7.653331 6.665569 7.320626 6.992004
44 7.608243 6.725489 7.387248 7.060275
45 7.563750 6.676142 7.308825 6.848430
46 7.614122 6.674357 7.303363 6.924984
47 7.596193 6.694495 7.306756 6.901427
48 7.606979 6.738551 7.326250 7.075850
49 7.593624 6.698417 7.340698 7.080536
50 7.543299 6.771432 7.302208 6.976786

$out_cf_y
          1        4        2        3
1  7.607414 7.241627 7.491580 7.233985
2  7.629989 7.175883 7.438672 7.212483
3  7.593847 7.247442 7.492807 7.189440
4  7.636815 7.247154 7.413713 7.170191
5  7.579692 7.455758 7.484690 7.201809
6  7.576799 7.155861 7.400021 7.370657
7  7.594346 7.214699 7.435885 7.201016
8  7.550623 7.151088 7.492054 7.540559
9  7.578009 7.233869 7.443912 7.093525
10 7.584653 7.362574 7.447179 7.274074
11 7.617740 7.272451 7.504440 7.298578
12 7.587291 7.339500 7.496442 7.085919
13 7.624523 7.385366 7.442322 7.356935
14 7.599690 7.218713 7.469391 7.235977
15 7.577244 7.383210 7.436937 7.392177
16 7.609999 7.393361 7.470339 7.195733
17 7.584932 7.420018 7.491768 7.261574
18 7.578244 7.254377 7.458756 7.223458
19 7.580229 7.269746 7.464720 7.195017
20 7.643505 7.154219 7.509154 7.172263
21 7.577978 7.352014 7.478805 7.269683
22 7.620846 7.433312 7.479854 7.302266
23 7.600740 7.173616 7.491643 7.306826
24 7.625785 7.277016 7.473609 7.127676
25 7.591045 7.274529 7.444616 7.291411
26 7.581488 7.264959 7.465865 7.008815
27 7.597288 7.414300 7.441858 7.187059
28 7.626680 7.300014 7.496952 7.040814
29 7.589927 7.158867 7.460670 7.154384
30 7.598552 7.174590 7.487488 7.261998
31 7.662883 7.166347 7.477567 7.374014
32 7.641907 7.242302 7.487043 7.168227
33 7.581495 7.313520 7.479004 7.389798
34 7.590214 7.370308 7.474344 7.297419
35 7.630770 7.325501 7.430298 7.332733
36 7.633509 7.268941 7.415104 7.397309
37 7.592106 7.105822 7.426028 7.199093
38 7.604581 7.172293 7.460978 7.311739
39 7.575793 7.168612 7.484473 7.132777
40 7.614368 7.213674 7.416985 7.150848
41 7.617792 7.227409 7.463862 7.133855
42 7.597207 7.443558 7.387119 7.053380
43 7.651733 7.302834 7.477593 7.174305
44 7.606760 7.238119 7.544200 7.360466
45 7.561765 7.197407 7.476156 7.196137
46 7.621505 7.178989 7.430615 7.389787
47 7.599247 7.233115 7.424585 7.335626
48 7.610071 7.200206 7.495498 7.266563
49 7.592124 7.159419 7.512929 7.217993
50 7.545320 7.359588 7.435835 7.243914

$out_nc_quantile_y
             1        4        2        3
2.5%  7.554194 6.642253 7.289444 6.851321
50%   7.596958 6.698040 7.320570 6.977659
97.5% 7.650829 6.777176 7.364472 7.085786

$out_cf_quantile_y
             1        4        2        3
2.5%  7.553130 7.151793 7.403101 7.043642
50%   7.597920 7.247298 7.469865 7.228721
97.5% 7.649881 7.441253 7.512079 7.396155

$mediation
        4         2         3 
0.6283431 0.5154469 0.4166421 

$mediation_quantile
              4         2         3
2.5%  0.4836956 0.3327377 0.1110938
97.5% 0.8243395 0.7036244 0.6867509

$mc_conv_info_m
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.689496 5.829198 7.091873 6.309873
 [2,] 7.703785 5.850273 7.113070 6.306611
 [3,] 7.701987 5.858959 7.098913 6.314230
 [4,] 7.705048 5.868545 7.101568 6.324108
 [5,] 7.706593 5.870395 7.098734 6.339593
 [6,] 7.703159 5.875024 7.099050 6.323742
 [7,] 7.703515 5.879523 7.098054 6.317544
 [8,] 7.702621 5.878158 7.101698 6.315582
 [9,] 7.706594 5.879419 7.100027 6.332194
[10,] 7.704393 5.878511 7.100601 6.334574

$mc_conv_info_y
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.606192 6.704516 7.339697 6.997885
 [2,] 7.609234 6.710571 7.344870 6.997330
 [3,] 7.608851 6.713067 7.341415 6.998625
 [4,] 7.609503 6.715821 7.342063 7.000305
 [5,] 7.609832 6.716352 7.341372 7.002938
 [6,] 7.609101 6.717682 7.341449 7.000243
 [7,] 7.609177 6.718975 7.341206 6.999189
 [8,] 7.608986 6.718583 7.342095 6.998855
 [9,] 7.609832 6.718945 7.341687 7.001680
[10,] 7.609364 6.718684 7.341827 7.002085</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9007578</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3357567</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5650011</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.6283431 0.5154469 0.4166421 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2795149</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1373915</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1421234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6208383</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.361873</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2589653</code></pre>
</div>
</div>
</section>
<section id="causal.decomp" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp"><code>causal.decomp</code></h2>
<ul>
<li><span class="citation" data-cites="Park2023a">Park, Kang, and Lee (<a href="#ref-Park2023a" role="doc-biblioref">2023</a>)</span> の方法。</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T <span class="sc">+</span> X<span class="sc">:</span>T <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">lm</span>(T <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fit_smi <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit.m =</span> fit.m,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="dv">1</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># baseline covariatesを調整できる</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#covariates = c("C1", "C2", "C3", "C4"),</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">227</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>fit_smi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                               estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.8993401   -0.9925190  -0.79813505
Disparity Remaining (1 vs 4) -0.3384430   -0.4880863  -0.14795873
Disparity Reduction (1 vs 4) -0.5608971   -0.7346168  -0.42650061
Initial Disparity   (1 vs 2) -0.2749659   -0.3378874  -0.19366549
Disparity Remaining (1 vs 2) -0.1213246   -0.2203441  -0.05458727
Disparity Reduction (1 vs 2) -0.1536412   -0.1896213  -0.10521328
Initial Disparity   (1 vs 3) -0.6137425   -0.7326095  -0.47793913
Disparity Remaining (1 vs 3) -0.3500123   -0.5151994  -0.08733348
Disparity Reduction (1 vs 3) -0.2637302   -0.4880614  -0.11574038</code></pre>
</div>
</div>
<ul>
<li>sensitivity analysis<span class="citation" data-cites="Park2023">(<a href="#ref-Park2023" role="doc-biblioref">Park et al. 2023</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi, <span class="at">fit.m =</span> fit.m, <span class="at">fit.y =</span> fit.y, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="binary-mediator" class="level1">
<h1>binary mediator</h1>
<section id="cfdecomp-1" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp-1"><code>cfdecomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b <span class="ot">&lt;-</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cfd.mean</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T2 + X:T2 + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T2 ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T2'</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'binomial'</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8981701</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5546351</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.343535</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.3828971 0.1298177 0.2061071 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2774845</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2419289</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.03555558</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5849521</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4655888</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1193632</code></pre>
</div>
</div>
</section>
<section id="causal.decomp-1" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp-1"><code>causal.decomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T2 <span class="sc">+</span> X<span class="sc">:</span>T2 <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>fit_smi_b <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fit.m =</span> fit.m,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>               <span class="co"># covariates = 1,</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>),</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">seed =</span> <span class="dv">123456</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>fit_smi_b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                                estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.95667843  -1.02938841  -0.88175003
Disparity Remaining (1 vs 4) -0.61262729  -0.77966809  -0.46844380
Disparity Reduction (1 vs 4) -0.34405113  -0.49650368  -0.21581205
Initial Disparity   (1 vs 2) -0.31394841  -0.38058533  -0.26000373
Disparity Remaining (1 vs 2) -0.27995004  -0.34624791  -0.22226331
Disparity Reduction (1 vs 2) -0.03399837  -0.05003528  -0.02022012
Initial Disparity   (1 vs 3) -0.59968604  -0.69525994  -0.49987857
Disparity Remaining (1 vs 3) -0.48148718  -0.61387973  -0.32105036
Disparity Reduction (1 vs 3) -0.11819886  -0.24676548  -0.03361808</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi_b, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.m =</span> fit.m, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.y =</span> fit.y, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T2"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gapclosing" class="level2">
<h2 class="anchored" data-anchor-id="gapclosing"><code>gapclosing</code></h2>
<ul>
<li><span class="citation" data-cites="Lundberg2022a">Lundberg (<a href="#ref-Lundberg2022a" role="doc-biblioref">2022</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - regression</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stochastic intervention</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># treatmentの割り当て確率の予測値を算出</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 全員のtreatmentが1だった時の予測値</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>assing_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_glm, <span class="at">newdata =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">X =</span> <span class="st">"1"</span>), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値をもとにrandom draw</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>draw <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>fit_gapclosing <span class="ot">&lt;-</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">*</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">counterfactual_assignments =</span> draw <span class="co"># random draw</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>機械学習をつかったdoubly robustな方法も使える</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - ranger, doubly robust</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fit_gapclosing_ranger <span class="ot">&lt;-</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">+</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_formula =</span> T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">counterfactual_assignments =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob) </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Lundberg2022a" class="csl-entry" role="listitem">
Lundberg, Ian. 2022. <span>“The <span>Gap-Closing Estimand</span>: <span>A Causal Approach</span> to <span>Study Interventions That Close Disparities Across Social Categories</span>.”</span> <em>Sociological Methods &amp; Research</em>, January. <a href="https://doi.org/10.1177/00491241211055769">https://doi.org/10.1177/00491241211055769</a>.
</div>
<div id="ref-Park2023a" class="csl-entry" role="listitem">
Park, Soojin, Suyeon Kang, and Chioun Lee. 2023. <span>“Choosing an <span>Optimal Method</span> for <span>Causal Decomposition Analysis</span> with <span>Continuous Outcomes</span>: <span>A Review</span> and <span>Simulation Study</span>.”</span> <em>Sociological Methodology</em>, July, 00811750231183711. <a href="https://doi.org/10.1177/00811750231183711">https://doi.org/10.1177/00811750231183711</a>.
</div>
<div id="ref-Park2023" class="csl-entry" role="listitem">
Park, Soojin, Suyeon Kang, Chioun Lee, and Shujie Ma. 2023. <span>“Sensitivity <span>Analysis</span> for <span>Causal Decomposition Analysis</span>: <span>Assessing Robustness Toward Omitted Variable Bias</span>.”</span> <em>Journal of Causal Inference</em> 11 (1): 20220031. <a href="https://doi.org/10.1515/jci-2022-0031">https://doi.org/10.1515/jci-2022-0031</a>.
</div>
<div id="ref-Sudharsanan2021" class="csl-entry" role="listitem">
Sudharsanan, Nikkil, and Maarten J Bijlsma. 2021. <span>“Educational <span>Note</span>: <span>Causal Decomposition</span> of <span>Population Health Differences Using Monte Carlo Integration</span> and the <span>G-Formula</span>.”</span> <em>International Journal of Epidemiology</em> 50 (6): 2098–2107. <a href="https://doi.org/10.1093/ije/dyab090">https://doi.org/10.1093/ije/dyab090</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>