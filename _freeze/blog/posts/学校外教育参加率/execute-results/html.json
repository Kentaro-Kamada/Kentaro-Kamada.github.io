{
  "hash": "fd3ccd5eadd57b88337cb587f44e0312",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 学校外教育の参加率\ndate: 2024-11-01\ncategories: [Others]\n---\n\n\n\n## パッケージ読み込み\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(estatapi)\n```\n:::\n\n\n\n## 準備\n\n- あらかじめE-Stat APIの申請を行い、アプリケーションIDを取得しておく必要がある\n- `.Renviron`や`.Rprofile`あたりで、環境変数`ESTAT_APPID`にアプリケーションIDを設定しておくと便利\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# E-Stat APIのアプリケーションIDを環境変数から取得\nappid <- Sys.getenv('ESTAT_APPID')\n```\n:::\n\n\n\n\n## メタデータ取得\n\n使用するデータは以下の3つ\n\n1. 「子供の学習費調査、3　学年（年齢）別，所在市町村の人口規模（学科）別の学習費支出状況 小学校」<https://e-stat.go.jp/stat-search/database?page=1&statdisp_id=0003368820>\n1. 「子供の学習費調査、3　学年（年齢）別，所在市町村の人口規模（学科）別の学習費支出状況 中学校」<https://e-stat.go.jp/stat-search/database?page=1&statdisp_id=0003368821>\n1. 「子供の学習費調査、3　学年（年齢）別，所在市町村の人口規模（学科）別の学習費支出状況 高等学校（全日制）」<https://e-stat.go.jp/stat-search/database?page=1&statdisp_id=0003368822>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 以下のコードでメタデータが取得できる\nestat_getMetaInfo(appid, '0003368820')\nestat_getMetaInfo(appid, '0003368821')\nestat_getMetaInfo(appid, '0003368822')\n```\n:::\n\n\n\n## データ取得\n\n- メタデータを参照しつつ必要な情報のみを取得\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nelementary <- \n  estat_getStatsData(\n    appid, \n    '0003368820',\n    cdTab = '110', \n    cdCat01 = '160,170,180,190,200,210', \n    cdCat02 = '320'\n  )\n\njhigh <- \n  estat_getStatsData(\n    appid, \n    '0003368821',\n    cdTab = '110', \n    cdCat01 = '160,170,180', \n    cdCat02 = '320'\n  )\n\nhigh <- \n  estat_getStatsData(\n    appid, \n    '0003368822',\n    cdTab = '110', \n    cdCat01 = '160,170,180', \n    cdCat02 = '320'\n  )\n```\n:::\n\n\n\n## データ整形＆プロット\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbind_rows(\n  小学校 = elementary,\n  中学校 = jhigh,\n  高校 = high,\n  .id = '学校段階'\n) |> \n  filter(`時間軸（年度次）` == '2016年度') |> \n  filter(!(学校段階 == '小学校' & `学年(年齢)・所在市町村人口規模(学科)` %in% c('第1学年', '第2学年', '第3学年'))) |> \n  \n  ggplot(aes(`学年(年齢)・所在市町村人口規模(学科)`, value))+\n  geom_bar(stat = 'identity')+\n  geom_label(aes(label = value), size = 3)+\n  facet_grid(rows = vars(公私立区分), cols = vars(学校段階), scales = 'free_x')+\n  labs(x = '学年', y = '学習塾利用率')+\n  theme_bw(base_family = 'Noto Sans JP')\n```\n\n::: {.cell-output-display}\n![](学校外教育参加率_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "学校外教育参加率_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}