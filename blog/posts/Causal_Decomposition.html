<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kentaro Kamada">
<meta name="dcterms.date" content="2024-02-22">

<title>Causal Decomposition Analysis – Kentaro Kamada</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9c546a04fa00a275547e7eb78afa1c09.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Kentaro Kamada</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../profile.html"> 
<span class="menu-text">Profile</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-works" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Works</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-works">    
        <li>
    <a class="dropdown-item" href="https://kentaro-kamada.github.io/kamaken/index.html" target="_blank">
 <span class="dropdown-text">R Package: kamaken</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://kentaro-kamada.github.io/jisshutools/index.html" target="_blank">
 <span class="dropdown-text">R Package: jisshutools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/Kentaro-Kamada/hyoron-style" target="_blank">
 <span class="dropdown-text">Latex Package: hyoron-style</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/Kentaro-Kamada/Kentaro-Kamada.github.io" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causal Decomposition Analysis</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Causal Inference</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kentaro Kamada </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 22, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#前準備" id="toc-前準備" class="nav-link active" data-scroll-target="#前準備">前準備</a></li>
  <li><a href="#continuuous-mediator" id="toc-continuuous-mediator" class="nav-link" data-scroll-target="#continuuous-mediator">continuuous mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp" id="toc-cfdecomp" class="nav-link" data-scroll-target="#cfdecomp"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp" id="toc-causal.decomp" class="nav-link" data-scroll-target="#causal.decomp"><code>causal.decomp</code></a></li>
  </ul></li>
  <li><a href="#binary-mediator" id="toc-binary-mediator" class="nav-link" data-scroll-target="#binary-mediator">binary mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp-1" id="toc-cfdecomp-1" class="nav-link" data-scroll-target="#cfdecomp-1"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp-1" id="toc-causal.decomp-1" class="nav-link" data-scroll-target="#causal.decomp-1"><code>causal.decomp</code></a></li>
  <li><a href="#gapclosing" id="toc-gapclosing" class="nav-link" data-scroll-target="#gapclosing"><code>gapclosing</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="前準備" class="level2">
<h2 class="anchored" data-anchor-id="前準備">前準備</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cfdecomp)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapclosing)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causal.decomp)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  sMIDUS <span class="sc">|&gt;</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">Y =</span> health <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),  <span class="co"># outcome</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">T =</span> edu <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),   <span class="co"># treatment (continuous)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">T2 =</span> edu <span class="sc">|&gt;</span> <span class="fu">case_match</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">~</span> <span class="dv">0</span>,   <span class="co"># treatment (binary)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">.default =</span> <span class="cn">NA</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">X =</span> racesex <span class="sc">|&gt;</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"4"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)),  <span class="co"># note!</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">L1 =</span> lowchildSES <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">L2 =</span> abuse <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">C1 =</span> age <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">C2 =</span> stroke <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">C3 =</span> T2DM <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">C4 =</span> heart <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(L1<span class="sc">:</span>C4, \(.x){.x <span class="sc">-</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})) <span class="sc">|&gt;</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="continuuous-mediator" class="level1">
<h1>continuuous mediator</h1>
<section id="cfdecomp" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp"><code>cfdecomp</code></h2>
<ul>
<li><span class="citation" data-cites="Sudharsanan2021">Sudharsanan and Bijlsma (<a href="#ref-Sudharsanan2021" role="doc-biblioref">2021</a>)</span> の方法。mediatorの値をシミュレーションで複数生成するのが特徴</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  cfdecomp<span class="sc">::</span><span class="fu">cfd.mean</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T + X:T + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$out_nc_m
          1        4        2        3
1  7.711633 5.888257 7.125844 6.352904
2  7.711335 5.888175 7.067714 6.367545
3  7.680955 5.879973 7.083105 6.290285
4  7.731151 5.883833 7.054332 6.314513
5  7.741197 5.919269 7.068209 6.411571
6  7.679647 5.874477 7.071199 6.442494
7  7.743790 5.900932 7.083522 6.434297
8  7.718472 5.884156 7.099022 6.309715
9  7.678637 5.804392 7.116342 6.344669
10 7.707989 5.879045 7.084649 6.386724
11 7.665000 5.854644 7.082168 6.404390
12 7.687069 5.879753 7.062328 6.411204
13 7.713308 5.892926 7.065359 6.375275
14 7.705918 5.886559 7.081125 6.461115
15 7.749694 5.860974 7.105595 6.348651
16 7.738547 5.872752 7.087563 6.404910
17 7.693606 5.850646 7.098890 6.459896
18 7.713330 5.893088 7.091596 6.376642
19 7.709143 5.823530 7.029086 6.413343
20 7.733210 5.858471 7.087219 6.467162
21 7.738161 5.911049 7.092461 6.335316
22 7.746965 5.920713 7.089514 6.283847
23 7.694358 5.888971 7.102488 6.363968
24 7.693684 5.908104 7.052797 6.421523
25 7.679553 5.875793 7.105435 6.411341
26 7.659899 5.884256 7.051559 6.460068
27 7.686961 5.894971 7.072704 6.403770
28 7.710311 5.869419 7.055817 6.434180
29 7.716763 5.903774 7.081851 6.455534
30 7.693189 5.868528 7.081334 6.421027
31 7.742753 5.925176 7.080192 6.333420
32 7.751380 5.894483 7.097142 6.455502
33 7.711411 5.809214 7.071902 6.437017
34 7.740161 5.911441 7.105231 6.511967
35 7.705447 5.909566 7.095954 6.380936
36 7.702558 5.903924 7.081581 6.407733
37 7.700893 5.881401 7.086621 6.461621
38 7.738122 5.904513 7.063869 6.395699
39 7.746447 5.870571 7.026998 6.484040
40 7.759368 5.910303 7.092030 6.406555
41 7.718450 5.831043 7.054374 6.358089
42 7.695918 5.835081 7.075573 6.416062
43 7.731954 5.813791 7.036193 6.421428
44 7.712310 5.893671 7.025246 6.455531
45 7.680701 5.846358 7.061539 6.407396
46 7.694061 5.845573 7.072832 6.391219
47 7.668851 5.817726 7.080903 6.406440
48 7.711376 5.949511 7.053901 6.456014
49 7.716736 5.826249 7.080758 6.422543
50 7.654022 5.866163 7.131136 6.413449

$out_cf_m
          1        4        2        3
1  7.710530 7.707118 7.729085 7.689582
2  7.722146 7.715962 7.718530 7.694744
3  7.685399 7.679285 7.699618 7.684752
4  7.710964 7.722139 7.724466 7.721053
5  7.730490 7.752241 7.751842 7.799405
6  7.664568 7.663683 7.674068 7.663177
7  7.724971 7.749857 7.752868 7.706792
8  7.714129 7.716862 7.722281 7.723609
9  7.683756 7.671424 7.702381 7.617404
10 7.695261 7.735147 7.719256 7.703986
11 7.670528 7.683359 7.689876 7.687277
12 7.706871 7.707688 7.704846 7.672708
13 7.704887 7.736651 7.703969 7.675736
14 7.709934 7.709054 7.727723 7.682492
15 7.740935 7.721385 7.747651 7.710687
16 7.742387 7.735513 7.746277 7.728202
17 7.691813 7.700624 7.705163 7.669490
18 7.695803 7.723519 7.715414 7.705193
19 7.714527 7.724800 7.728529 7.731613
20 7.752440 7.731310 7.731205 7.740443
21 7.747701 7.751927 7.746104 7.736706
22 7.744353 7.753527 7.757974 7.699908
23 7.698835 7.707310 7.733331 7.642548
24 7.688320 7.678430 7.695832 7.700293
25 7.678879 7.703020 7.682947 7.674868
26 7.662760 7.686827 7.677796 7.669470
27 7.667674 7.688950 7.702769 7.645594
28 7.708490 7.720959 7.712414 7.715071
29 7.717942 7.738635 7.736016 7.725968
30 7.696543 7.693711 7.704273 7.674739
31 7.732255 7.762128 7.749186 7.722042
32 7.746046 7.742624 7.751110 7.730741
33 7.713978 7.723498 7.716193 7.716831
34 7.745275 7.731578 7.746356 7.749622
35 7.705166 7.686891 7.714852 7.647096
36 7.700198 7.701480 7.708816 7.661288
37 7.711325 7.716404 7.731762 7.711473
38 7.712923 7.725907 7.735120 7.730548
39 7.750298 7.756705 7.764771 7.732673
40 7.766789 7.768882 7.776410 7.764838
41 7.717941 7.713504 7.723617 7.715233
42 7.679975 7.704309 7.704923 7.687836
43 7.737060 7.735301 7.739600 7.718730
44 7.708164 7.721542 7.701967 7.645525
45 7.682980 7.686698 7.681756 7.670019
46 7.695651 7.713801 7.706790 7.662348
47 7.665926 7.714450 7.687832 7.659873
48 7.703820 7.719615 7.695535 7.688421
49 7.726563 7.701374 7.736214 7.689662
50 7.645600 7.695163 7.665097 7.640491

$out_nc_quantile_m
             1        4        2        3
2.5%  7.661047 5.810243 7.027468 6.294657
50%   7.711356 5.882617 7.081230 6.409468
97.5% 7.751000 5.924172 7.123706 6.480242

$out_cf_quantile_m
             1        4        2        3
2.5%  7.663167 7.673000 7.674907 7.640954
50%   7.709212 7.716633 7.718893 7.697326
97.5% 7.751958 7.760908 7.763242 7.761414

$out_nc_y
          1        4        2        3
1  7.643030 6.732799 7.375613 6.910479
2  7.607577 6.717165 7.346198 7.052359
3  7.607693 6.599873 7.269480 6.873304
4  7.610145 6.723795 7.289715 6.952498
5  7.616292 6.678440 7.333097 7.001349
6  7.557731 6.704395 7.250811 6.992294
7  7.599877 6.719521 7.340502 7.077658
8  7.628274 6.719762 7.296094 6.900450
9  7.519645 6.578178 7.334936 6.963192
10 7.636567 6.695734 7.262511 7.051596
11 7.611775 6.700613 7.292579 7.049620
12 7.631828 6.683791 7.331269 7.083689
13 7.563892 6.674326 7.316754 6.908562
14 7.603895 6.737479 7.327165 6.927612
15 7.618607 6.670229 7.255864 6.985934
16 7.622240 6.704231 7.320607 7.053559
17 7.585641 6.734660 7.341138 6.945470
18 7.604256 6.707089 7.302909 7.041279
19 7.524772 6.703693 7.298052 7.103668
20 7.553036 6.722339 7.308819 7.009432
21 7.574128 6.759331 7.311300 6.899021
22 7.609917 6.680900 7.350035 6.967131
23 7.607101 6.731611 7.357399 6.922846
24 7.620362 6.689117 7.271719 6.909727
25 7.600291 6.721549 7.343278 7.091111
26 7.580349 6.750467 7.322421 7.079178
27 7.588436 6.694641 7.341734 6.990717
28 7.573369 6.765644 7.320928 6.946950
29 7.578826 6.691312 7.331328 6.974224
30 7.601308 6.629131 7.267103 6.999810
31 7.603843 6.783977 7.376238 6.952896
32 7.603542 6.734427 7.370235 6.965581
33 7.620574 6.695155 7.328574 6.988810
34 7.631733 6.629085 7.316282 7.039475
35 7.614603 6.723767 7.332842 6.990229
36 7.587058 6.682920 7.313699 6.875552
37 7.590790 6.698495 7.371529 7.092733
38 7.599795 6.681993 7.317343 6.869174
39 7.585488 6.704832 7.335817 7.077249
40 7.609017 6.707175 7.327749 6.978417
41 7.570631 6.681757 7.330553 6.931524
42 7.622285 6.650356 7.320067 6.998195
43 7.620196 6.697024 7.337561 6.933217
44 7.625899 6.619717 7.265149 7.086506
45 7.541506 6.675692 7.294960 6.897559
46 7.634605 6.657319 7.288395 6.937194
47 7.590675 6.667401 7.355573 6.968337
48 7.640129 6.790121 7.279111 6.935163
49 7.598317 6.712968 7.344339 7.088489
50 7.609962 6.684222 7.339409 7.026853

$out_cf_y
          1        4        2        3
1  7.642828 7.228655 7.472077 7.044363
2  7.610666 7.217077 7.479253 7.210653
3  7.608739 7.042916 7.414806 7.153437
4  7.605145 7.217781 7.452585 7.336006
5  7.613874 7.287004 7.518205 7.143872
6  7.554566 7.294251 7.384723 7.342034
7  7.595708 7.312383 7.507010 7.324459
8  7.627264 7.353019 7.429607 7.023240
9  7.520749 7.217301 7.498648 7.195415
10 7.634141 7.158135 7.437276 7.380509
11 7.613326 7.312547 7.438580 7.217391
12 7.636896 7.233261 7.494746 7.434478
13 7.561744 7.346572 7.457141 7.021547
14 7.604743 7.324411 7.453311 7.211474
15 7.616689 7.236342 7.432433 7.312738
16 7.623216 7.294132 7.488400 7.301480
17 7.585169 7.293564 7.492201 7.007174
18 7.599991 7.097552 7.472330 7.256049
19 7.525761 7.140974 7.451360 7.495060
20 7.557790 7.315725 7.505289 7.214017
21 7.576391 7.363599 7.451759 7.137034
22 7.609120 7.228905 7.483233 7.328490
23 7.608396 7.173141 7.499450 7.104582
24 7.619150 7.134299 7.413481 7.102330
25 7.600139 7.295098 7.489918 7.308457
26 7.581097 7.396744 7.491733 7.300458
27 7.582923 7.368377 7.515990 7.358491
28 7.572931 7.244174 7.466398 7.172318
29 7.579088 7.366221 7.480393 7.158943
30 7.601925 7.050239 7.405865 7.281161
31 7.601097 7.217883 7.501238 7.079388
32 7.602343 7.215997 7.486182 7.362801
33 7.621057 7.371830 7.477008 7.321741
34 7.632899 7.159265 7.465772 7.294746
35 7.614549 7.213676 7.464199 7.014393
36 7.586656 7.270587 7.435904 7.400305
37 7.593428 7.108840 7.522947 7.414827
38 7.593836 7.193211 7.492250 7.175875
39 7.586345 7.250112 7.477559 7.152434
40 7.610498 7.269978 7.452130 7.254088
41 7.570510 7.347217 7.476158 7.220753
42 7.618182 7.287882 7.412706 7.084224
43 7.621420 7.233066 7.507654 7.124081
44 7.624912 7.074213 7.438136 7.212636
45 7.541945 7.178940 7.451000 7.109039
46 7.635028 7.263358 7.453537 7.242004
47 7.590112 7.170538 7.506422 6.924094
48 7.638272 7.468543 7.431446 7.129897
49 7.600589 7.215825 7.450062 7.366063
50 7.607752 7.131514 7.427264 7.360753

$out_nc_quantile_y
             1        4        2        3
2.5%  7.528537 6.604338 7.257360 6.873810
50%   7.604075 6.699554 7.324793 6.982175
97.5% 7.639328 6.779852 7.374694 7.092368

$out_cf_quantile_y
             1        4        2        3
2.5%  7.529402 7.055633 7.407404 7.008799
50%   7.603543 7.234802 7.469238 7.215704
97.5% 7.637962 7.391138 7.517707 7.430056

$mediation
        4         2         3 
0.6073567 0.5348774 0.3926196 

$mediation_quantile
              4         2          3
2.5%  0.4362047 0.3328234 0.05168082
97.5% 0.7746384 0.7824060 0.71708929

$mc_conv_info_m
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.723179 5.928527 7.115377 6.273738
 [2,] 7.703455 5.931829 7.113009 6.283259
 [3,] 7.707302 5.893149 7.113309 6.302433
 [4,] 7.705497 5.903295 7.112800 6.309729
 [5,] 7.706187 5.906655 7.120460 6.311052
 [6,] 7.712124 5.901055 7.122027 6.330075
 [7,] 7.710921 5.900642 7.118638 6.347855
 [8,] 7.708649 5.901588 7.121293 6.351281
 [9,] 7.712484 5.896719 7.121812 6.349336
[10,] 7.711633 5.888257 7.125844 6.352904

$mc_conv_info_y
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.645142 6.743777 7.373939 6.902550
 [2,] 7.641534 6.744677 7.373561 6.903504
 [3,] 7.642238 6.734132 7.373609 6.905424
 [4,] 7.641907 6.736898 7.373527 6.906155
 [5,] 7.642034 6.737814 7.374752 6.906288
 [6,] 7.643120 6.736288 7.375003 6.908193
 [7,] 7.642899 6.736175 7.374461 6.909974
 [8,] 7.642484 6.736433 7.374885 6.910317
 [9,] 7.643185 6.735106 7.374968 6.910122
[10,] 7.643030 6.732799 7.375613 6.910479</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9016258</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3558926</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5457332</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.6073567 0.5348774 0.3926196 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2804946</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1334747</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1470199</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6136728</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3771942</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2364786</code></pre>
</div>
</div>
</section>
<section id="causal.decomp" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp"><code>causal.decomp</code></h2>
<ul>
<li><span class="citation" data-cites="Park2023">Park et al. (<a href="#ref-Park2023" role="doc-biblioref">2023</a>)</span> の方法。</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T <span class="sc">+</span> X<span class="sc">:</span>T <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">lm</span>(T <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fit_smi <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit.m =</span> fit.m,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="dv">1</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># baseline covariatesを調整できる</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#covariates = c("C1", "C2", "C3", "C4"),</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">227</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>fit_smi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                               estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.8993401   -0.9925190  -0.79813505
Disparity Remaining (1 vs 4) -0.3384430   -0.4880863  -0.14795873
Disparity Reduction (1 vs 4) -0.5608971   -0.7346168  -0.42650061
Initial Disparity   (1 vs 2) -0.2749659   -0.3378874  -0.19366549
Disparity Remaining (1 vs 2) -0.1213246   -0.2203441  -0.05458727
Disparity Reduction (1 vs 2) -0.1536412   -0.1896213  -0.10521328
Initial Disparity   (1 vs 3) -0.6137425   -0.7326095  -0.47793913
Disparity Remaining (1 vs 3) -0.3500123   -0.5151994  -0.08733348
Disparity Reduction (1 vs 3) -0.2637302   -0.4880614  -0.11574038</code></pre>
</div>
</div>
<ul>
<li>sensitivity analysis<span class="citation" data-cites="Park2023">(<a href="#ref-Park2023" role="doc-biblioref">Park et al. 2023</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi, <span class="at">fit.m =</span> fit.m, <span class="at">fit.y =</span> fit.y, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="binary-mediator" class="level1">
<h1>binary mediator</h1>
<section id="cfdecomp-1" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp-1"><code>cfdecomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b <span class="ot">&lt;-</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cfd.mean</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T2 + X:T2 + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T2 ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T2'</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'binomial'</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8981701</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5546351</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.343535</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.3828971 0.1298177 0.2061071 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2774845</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2419289</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.03555558</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5849521</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4655888</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1193632</code></pre>
</div>
</div>
</section>
<section id="causal.decomp-1" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp-1"><code>causal.decomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T2 <span class="sc">+</span> X<span class="sc">:</span>T2 <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>fit_smi_b <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fit.m =</span> fit.m,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>               <span class="co"># covariates = 1,</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>),</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">seed =</span> <span class="dv">123456</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>fit_smi_b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                                estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.95667843  -1.02938841  -0.88175003
Disparity Remaining (1 vs 4) -0.61262729  -0.77966809  -0.46844380
Disparity Reduction (1 vs 4) -0.34405113  -0.49650368  -0.21581205
Initial Disparity   (1 vs 2) -0.31394841  -0.38058533  -0.26000373
Disparity Remaining (1 vs 2) -0.27995004  -0.34624791  -0.22226331
Disparity Reduction (1 vs 2) -0.03399837  -0.05003528  -0.02022012
Initial Disparity   (1 vs 3) -0.59968604  -0.69525994  -0.49987857
Disparity Remaining (1 vs 3) -0.48148718  -0.61387973  -0.32105036
Disparity Reduction (1 vs 3) -0.11819886  -0.24676548  -0.03361808</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi_b, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.m =</span> fit.m, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.y =</span> fit.y, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T2"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gapclosing" class="level2">
<h2 class="anchored" data-anchor-id="gapclosing"><code>gapclosing</code></h2>
<ul>
<li><span class="citation" data-cites="Lundberg2022a">Lundberg (<a href="#ref-Lundberg2022a" role="doc-biblioref">2022</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - regression</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stochastic intervention</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># treatmentの割り当て確率の予測値を算出</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 全員のtreatmentが1だった時の予測値</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>assing_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_glm, <span class="at">newdata =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">X =</span> <span class="st">"1"</span>), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値をもとにrandom draw</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>draw <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>fit_gapclosing <span class="ot">&lt;-</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">*</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">counterfactual_assignments =</span> draw <span class="co"># random draw</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>機械学習をつかったdoubly robustな方法も使える</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - ranger, doubly robust</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fit_gapclosing_ranger <span class="ot">&lt;-</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">+</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_formula =</span> T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">counterfactual_assignments =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob) </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Lundberg2022a" class="csl-entry" role="listitem">
Lundberg, Ian. 2022. <span>“The <span>Gap-Closing Estimand</span>: <span>A Causal Approach</span> to <span>Study Interventions That Close Disparities Across Social Categories</span>.”</span> <em>Sociological Methods &amp; Research</em>, January. <a href="https://doi.org/10.1177/00491241211055769">https://doi.org/10.1177/00491241211055769</a>.
</div>
<div id="ref-Park2023" class="csl-entry" role="listitem">
Park, Soojin, Suyeon Kang, Chioun Lee, and Shujie Ma. 2023. <span>“Sensitivity <span>Analysis</span> for <span>Causal Decomposition Analysis</span>: <span>Assessing Robustness Toward Omitted Variable Bias</span>.”</span> <em>Journal of Causal Inference</em> 11 (1). <a href="https://doi.org/10.1515/jci-2022-0031">https://doi.org/10.1515/jci-2022-0031</a>.
</div>
<div id="ref-Sudharsanan2021" class="csl-entry" role="listitem">
Sudharsanan, Nikkil, and Maarten J Bijlsma. 2021. <span>“Educational <span>Note</span>: <span>Causal Decomposition</span> of <span>Population Health Differences Using Monte Carlo Integration</span> and the <span>G-Formula</span>.”</span> <em>International Journal of Epidemiology</em> 50 (6): 2098–2107. <a href="https://doi.org/10.1093/ije/dyab090">https://doi.org/10.1093/ije/dyab090</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Kentaro-Kamada\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>