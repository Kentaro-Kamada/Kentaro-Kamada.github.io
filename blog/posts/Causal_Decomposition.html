<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kentaro Kamada">
<meta name="dcterms.date" content="2024-02-22">

<title>Causal Decomposition Analysis – Kentaro Kamada</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-75d7e103a1ccf8792fe8d88d8cc53775.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Kentaro Kamada</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../profile.html"> 
<span class="menu-text">Profile</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-works" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Works</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-works">    
        <li>
    <a class="dropdown-item" href="https://kentaro-kamada.github.io/kamaken/index.html" target="_blank">
 <span class="dropdown-text">R Package: kamaken</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://kentaro-kamada.github.io/jisshutools/index.html" target="_blank">
 <span class="dropdown-text">R Package: jisshutools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/Kentaro-Kamada/hyoron-style" target="_blank">
 <span class="dropdown-text">Latex Package: hyoron-style</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/Kentaro-Kamada/Kentaro-Kamada.github.io" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causal Decomposition Analysis</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Causal Inference</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kentaro Kamada </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 22, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#前準備" id="toc-前準備" class="nav-link active" data-scroll-target="#前準備">前準備</a></li>
  <li><a href="#continuuous-mediator" id="toc-continuuous-mediator" class="nav-link" data-scroll-target="#continuuous-mediator">continuuous mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp" id="toc-cfdecomp" class="nav-link" data-scroll-target="#cfdecomp"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp" id="toc-causal.decomp" class="nav-link" data-scroll-target="#causal.decomp"><code>causal.decomp</code></a></li>
  </ul></li>
  <li><a href="#binary-mediator" id="toc-binary-mediator" class="nav-link" data-scroll-target="#binary-mediator">binary mediator</a>
  <ul class="collapse">
  <li><a href="#cfdecomp-1" id="toc-cfdecomp-1" class="nav-link" data-scroll-target="#cfdecomp-1"><code>cfdecomp</code></a></li>
  <li><a href="#causal.decomp-1" id="toc-causal.decomp-1" class="nav-link" data-scroll-target="#causal.decomp-1"><code>causal.decomp</code></a></li>
  <li><a href="#gapclosing" id="toc-gapclosing" class="nav-link" data-scroll-target="#gapclosing"><code>gapclosing</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="前準備" class="level2">
<h2 class="anchored" data-anchor-id="前準備">前準備</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cfdecomp)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapclosing)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causal.decomp)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  sMIDUS <span class="sc">|&gt;</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">Y =</span> health <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),  <span class="co"># outcome</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">T =</span> edu <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),   <span class="co"># treatment (continuous)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">T2 =</span> edu <span class="sc">|&gt;</span> <span class="fu">case_match</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">~</span> <span class="dv">0</span>,   <span class="co"># treatment (binary)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">.default =</span> <span class="cn">NA</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">X =</span> racesex <span class="sc">|&gt;</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"4"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)),  <span class="co"># note!</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">L1 =</span> lowchildSES <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">L2 =</span> abuse <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">C1 =</span> age <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">C2 =</span> stroke <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">C3 =</span> T2DM <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">C4 =</span> heart <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(L1<span class="sc">:</span>C4, \(.x){.x <span class="sc">-</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})) <span class="sc">|&gt;</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="continuuous-mediator" class="level1">
<h1>continuuous mediator</h1>
<section id="cfdecomp" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp"><code>cfdecomp</code></h2>
<ul>
<li><span class="citation" data-cites="Sudharsanan2021">Sudharsanan and Bijlsma (<a href="#ref-Sudharsanan2021" role="doc-biblioref">2021</a>)</span> の方法。mediatorの値をシミュレーションで複数生成するのが特徴</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  cfdecomp<span class="sc">::</span><span class="fu">cfd.mean</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T + X:T + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$out_nc_m
          1        4        2        3
1  7.733828 5.823300 7.109919 6.339354
2  7.705857 5.887552 7.059308 6.384796
3  7.745491 5.816555 7.065829 6.359982
4  7.695950 5.857150 7.109466 6.404936
5  7.749740 5.816569 7.088806 6.438915
6  7.743337 5.838611 7.109247 6.393261
7  7.722353 5.802882 7.082883 6.428800
8  7.706924 5.848398 7.069223 6.478762
9  7.688822 5.822888 7.112621 6.427575
10 7.712176 5.916278 7.075500 6.542631
11 7.753094 5.934160 7.024267 6.342056
12 7.721882 5.830746 7.079876 6.398012
13 7.730350 5.848534 7.069327 6.481873
14 7.712068 5.882159 7.068574 6.329535
15 7.642138 5.866412 7.089691 6.481205
16 7.711352 5.864387 7.062973 6.463713
17 7.697758 5.950426 7.038410 6.442815
18 7.666818 5.887269 7.078397 6.524855
19 7.707273 5.893927 7.083165 6.421992
20 7.721174 5.850679 7.103607 6.440544
21 7.730725 5.862672 7.066366 6.464667
22 7.717825 5.844396 7.035532 6.473902
23 7.701229 5.908771 7.102834 6.455179
24 7.686511 5.948321 7.076630 6.418381
25 7.683956 5.859027 7.075319 6.474196
26 7.689608 5.842157 7.101255 6.347129
27 7.706565 5.922211 7.065158 6.509997
28 7.742376 5.834216 7.059701 6.405482
29 7.723596 5.852520 7.076190 6.369693
30 7.690246 5.872020 7.079470 6.338187
31 7.726875 5.881174 7.082164 6.459880
32 7.708075 5.879050 7.065662 6.495468
33 7.709293 5.907462 7.093476 6.386940
34 7.706883 5.887630 7.083416 6.417473
35 7.679251 5.840690 7.076815 6.425224
36 7.733052 5.862534 7.107096 6.489399
37 7.773463 5.850751 7.073770 6.378006
38 7.675113 5.895002 7.103607 6.337163
39 7.713443 5.865797 7.112969 6.359381
40 7.695383 5.962722 7.089270 6.406525
41 7.728607 5.936738 7.119379 6.417328
42 7.683926 5.817651 7.067036 6.356424
43 7.678275 5.849923 7.067574 6.294538
44 7.736162 5.881177 7.063355 6.386493
45 7.735249 5.902102 7.091964 6.436036
46 7.647793 5.851877 7.063806 6.353024
47 7.707648 5.821325 7.047502 6.424574
48 7.701770 5.803027 7.088441 6.339416
49 7.690957 5.891453 7.042343 6.364659
50 7.680671 5.872399 7.093639 6.393626

$out_cf_m
          1        4        2        3
1  7.742376 7.770440 7.755110 7.732658
2  7.694959 7.704526 7.726669 7.690254
3  7.748189 7.738311 7.780096 7.790556
4  7.697173 7.683629 7.699747 7.691527
5  7.745796 7.771502 7.765814 7.780343
6  7.742691 7.779501 7.762333 7.757792
7  7.718566 7.711753 7.738197 7.677267
8  7.713879 7.710798 7.726840 7.742962
9  7.686975 7.689332 7.685553 7.661831
10 7.692474 7.713145 7.716765 7.702644
11 7.754601 7.742869 7.759224 7.732502
12 7.722492 7.739328 7.703166 7.681141
13 7.734625 7.755641 7.740653 7.735323
14 7.719868 7.739795 7.730410 7.691248
15 7.650855 7.655804 7.654462 7.655408
16 7.710193 7.695737 7.733339 7.724394
17 7.712012 7.704681 7.727589 7.728458
18 7.672993 7.673615 7.664840 7.655656
19 7.719795 7.721563 7.713047 7.709342
20 7.714674 7.706375 7.744438 7.746682
21 7.731461 7.716562 7.729537 7.719041
22 7.708469 7.737277 7.707661 7.688520
23 7.715962 7.705924 7.728389 7.726844
24 7.691614 7.698007 7.689020 7.647028
25 7.704290 7.683604 7.679754 7.656410
26 7.704748 7.710178 7.717056 7.645112
27 7.726442 7.710400 7.713291 7.686871
28 7.750639 7.745066 7.757735 7.741659
29 7.729355 7.711171 7.721181 7.677543
30 7.701773 7.695609 7.700016 7.710716
31 7.731307 7.741333 7.739887 7.741304
32 7.722005 7.730877 7.734980 7.718447
33 7.706431 7.698556 7.696195 7.702831
34 7.695088 7.734643 7.708540 7.665806
35 7.677574 7.680168 7.686748 7.663077
36 7.726518 7.714751 7.741753 7.723733
37 7.769060 7.773000 7.784093 7.753708
38 7.689886 7.702558 7.714529 7.709536
39 7.703390 7.717552 7.710301 7.703063
40 7.695115 7.708155 7.704712 7.686051
41 7.746696 7.747342 7.740109 7.756098
42 7.683567 7.710347 7.699576 7.679254
43 7.677108 7.683184 7.676242 7.590870
44 7.747905 7.759307 7.763705 7.765841
45 7.728808 7.759884 7.753542 7.697682
46 7.656526 7.663537 7.663550 7.626192
47 7.714101 7.738422 7.735024 7.721761
48 7.702706 7.698290 7.704638 7.674845
49 7.668032 7.692687 7.691389 7.662267
50 7.676647 7.684100 7.691192 7.620790

$out_nc_quantile_m
             1        4        2        3
2.5%  7.652073 5.806071 7.036180 6.331251
50%   7.707862 5.863529 7.077606 6.417401
97.5% 7.752339 5.949952 7.112890 6.521512

$out_cf_quantile_m
             1        4        2        3
2.5%  7.659115 7.665805 7.663840 7.622006
50%   7.712945 7.710984 7.719119 7.702738
97.5% 7.753709 7.772663 7.776883 7.777080

$out_nc_y
          1        4        2        3
1  7.560252 6.733358 7.311205 6.971600
2  7.633687 6.696184 7.345035 6.962514
3  7.589192 6.666874 7.360186 6.938058
4  7.608588 6.720913 7.323476 6.967779
5  7.612698 6.729768 7.344233 7.042032
6  7.598409 6.658928 7.317580 7.047435
7  7.632760 6.662387 7.353901 6.926887
8  7.582283 6.714781 7.275925 7.060335
9  7.577127 6.649478 7.334549 7.045467
10 7.586404 6.682392 7.309118 7.108105
11 7.654354 6.672843 7.314367 6.979199
12 7.640207 6.663490 7.364594 7.088919
13 7.579451 6.783506 7.354916 7.032341
14 7.541339 6.708060 7.305381 7.018491
15 7.559636 6.679031 7.299831 7.023424
16 7.619413 6.755236 7.342931 6.902480
17 7.585451 6.698123 7.330866 6.902933
18 7.564628 6.713548 7.300838 6.959534
19 7.600697 6.693409 7.340167 7.059749
20 7.593858 6.662574 7.309823 7.006783
21 7.642924 6.610889 7.279115 7.050430
22 7.616692 6.703528 7.282671 7.050421
23 7.574635 6.757990 7.279736 6.987562
24 7.554747 6.707141 7.325666 6.879229
25 7.592697 6.755147 7.272497 6.870838
26 7.617734 6.649496 7.350127 6.788462
27 7.625945 6.713108 7.308444 7.051906
28 7.603046 6.696331 7.329336 6.899088
29 7.584451 6.687452 7.313386 6.831989
30 7.553215 6.679427 7.299587 6.981646
31 7.581753 6.681836 7.290647 7.004291
32 7.587827 6.733731 7.335669 7.024730
33 7.596489 6.716750 7.317731 6.993357
34 7.644542 6.685643 7.320475 7.111905
35 7.606085 6.686374 7.305567 6.988819
36 7.599733 6.665123 7.318581 7.053930
37 7.630778 6.675914 7.294010 7.018002
38 7.592443 6.708982 7.331472 7.016699
39 7.555697 6.667644 7.288286 6.975222
40 7.626456 6.710216 7.342688 6.987325
41 7.603735 6.710846 7.346065 7.045939
42 7.599178 6.729854 7.288563 7.016309
43 7.597834 6.692000 7.364097 6.988366
44 7.588201 6.743449 7.366221 6.911526
45 7.609964 6.721683 7.290814 6.911986
46 7.561772 6.727422 7.276534 6.996396
47 7.603035 6.668523 7.323307 7.078868
48 7.650779 6.678678 7.308019 6.920890
49 7.607569 6.705581 7.327924 6.891258
50 7.577771 6.734214 7.344265 7.069573

$out_cf_y
          1        4        2        3
1  7.562610 7.227217 7.444130 7.415721
2  7.630873 7.198015 7.520648 7.298267
3  7.589890 7.348802 7.513238 7.174003
4  7.608913 7.394068 7.484199 7.263336
5  7.611518 7.286773 7.529202 7.301301
6  7.598244 7.194579 7.495074 7.356278
7  7.631816 7.197288 7.488397 7.537564
8  7.583922 7.212883 7.436632 7.142861
9  7.576577 7.251856 7.522652 7.224769
10 7.580963 7.313998 7.468794 7.251081
11 7.654695 7.200927 7.494772 7.300255
12 7.640348 7.337751 7.502978 7.216710
13 7.580626 7.477383 7.502634 7.159349
14 7.542686 7.180172 7.445250 7.243244
15 7.561933 7.234646 7.386100 7.361893
16 7.619117 7.313334 7.475914 7.076738
17 7.588305 7.262150 7.488637 7.416694
18 7.565734 7.139137 7.434885 7.083316
19 7.602836 7.202656 7.464372 7.369318
20 7.592338 7.405376 7.466134 7.286899
21 7.643107 7.187207 7.459682 7.255134
22 7.614282 7.224898 7.480568 7.326376
23 7.577840 7.262907 7.413502 7.277020
24 7.555881 7.119477 7.453738 7.086990
25 7.596765 7.167447 7.397616 7.150798
26 7.621375 7.207039 7.490602 6.998488
27 7.630471 7.234501 7.426337 7.245591
28 7.605114 7.271265 7.478565 7.057391
29 7.585954 7.126091 7.495482 7.078813
30 7.556530 7.222032 7.456077 7.371984
31 7.582808 7.276768 7.432127 7.279758
32 7.590913 7.292329 7.487761 7.218881
33 7.595808 7.249002 7.445578 7.173627
34 7.642040 7.290495 7.458510 7.276923
35 7.605710 7.221801 7.449461 7.105210
36 7.598211 7.291992 7.454724 7.338380
37 7.629559 7.053276 7.487850 7.256398
38 7.596131 7.151108 7.478593 7.428826
39 7.553335 7.081500 7.415931 7.173587
40 7.626394 7.233598 7.464722 7.392671
41 7.608158 7.142582 7.472246 7.296912
42 7.599088 7.245252 7.434806 7.250802
43 7.597586 7.225666 7.475792 7.165518
44 7.590751 7.309139 7.559975 7.154915
45 7.608529 7.339840 7.464676 7.293674
46 7.563985 7.202997 7.401533 7.239464
47 7.604356 7.144586 7.471619 7.291824
48 7.650993 7.243144 7.450962 7.224556
49 7.602245 7.124643 7.444893 7.039003
50 7.576728 7.196806 7.465552 7.333518

$out_nc_quantile_y
             1        4        2        3
2.5%  7.553560 6.649482 7.276062 6.840730
50%   7.598121 6.697227 7.318156 6.994877
97.5% 7.649376 6.757371 7.364482 7.103788

$out_cf_quantile_y
             1        4        2        3
2.5%  7.553908 7.090045 7.398497 7.043140
50%   7.597899 7.226441 7.465843 7.253107
97.5% 7.649218 7.402832 7.527728 7.426096

$mediation
        4         2         3 
0.5960221 0.5337967 0.4219810 

$mediation_quantile
              4         2         3
2.5%  0.4649193 0.3756905 0.1921605
97.5% 0.7887737 0.7559828 0.7540824

$mc_conv_info_m
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.746281 5.857004 7.097588 6.340873
 [2,] 7.737009 5.824329 7.095680 6.294820
 [3,] 7.733742 5.831281 7.102417 6.327331
 [4,] 7.744034 5.826502 7.107326 6.335852
 [5,] 7.749761 5.815956 7.104579 6.344717
 [6,] 7.741292 5.822553 7.102921 6.334976
 [7,] 7.735675 5.820890 7.106525 6.336334
 [8,] 7.737412 5.826674 7.107978 6.333732
 [9,] 7.734444 5.828166 7.111650 6.346099
[10,] 7.733828 5.823300 7.109919 6.339354

$mc_conv_info_y
          [,1]     [,2]     [,3]     [,4]
 [1,] 7.563688 6.741906 7.308664 6.972084
 [2,] 7.561130 6.733619 7.308271 6.957404
 [3,] 7.560228 6.735382 7.309659 6.967767
 [4,] 7.563068 6.734170 7.310671 6.970483
 [5,] 7.564648 6.731495 7.310105 6.973309
 [6,] 7.562311 6.733168 7.309763 6.970204
 [7,] 7.560762 6.732747 7.310506 6.970637
 [8,] 7.561241 6.734214 7.310805 6.969808
 [9,] 7.560422 6.734592 7.311561 6.973750
[10,] 7.560252 6.733358 7.311205 6.971600</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8991661</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3637952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">2</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.535371</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.5960221 0.5337967 0.4219810 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2789548</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1314808</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">3</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.147474</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6093427</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3529107</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp<span class="sc">$</span>out_nc_y[,<span class="dv">4</span>] <span class="sc">-</span> fit_cfdecomp<span class="sc">$</span>out_cf_y[,<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.256432</code></pre>
</div>
</div>
</section>
<section id="causal.decomp" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp"><code>causal.decomp</code></h2>
<ul>
<li><span class="citation" data-cites="Park2023">Park et al. (<a href="#ref-Park2023" role="doc-biblioref">2023</a>)</span> の方法。</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T <span class="sc">+</span> X<span class="sc">:</span>T <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">lm</span>(T <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fit_smi <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit.m =</span> fit.m,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="dv">1</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># baseline covariatesを調整できる</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#covariates = c("C1", "C2", "C3", "C4"),</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">227</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>fit_smi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                               estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.8993401   -0.9925190  -0.79813505
Disparity Remaining (1 vs 4) -0.3384430   -0.4880863  -0.14795873
Disparity Reduction (1 vs 4) -0.5608971   -0.7346168  -0.42650061
Initial Disparity   (1 vs 2) -0.2749659   -0.3378874  -0.19366549
Disparity Remaining (1 vs 2) -0.1213246   -0.2203441  -0.05458727
Disparity Reduction (1 vs 2) -0.1536412   -0.1896213  -0.10521328
Initial Disparity   (1 vs 3) -0.6137425   -0.7326095  -0.47793913
Disparity Remaining (1 vs 3) -0.3500123   -0.5151994  -0.08733348
Disparity Reduction (1 vs 3) -0.2637302   -0.4880614  -0.11574038</code></pre>
</div>
</div>
<ul>
<li>sensitivity analysis<span class="citation" data-cites="Park2023">(<a href="#ref-Park2023" role="doc-biblioref">Park et al. 2023</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi, <span class="at">fit.m =</span> fit.m, <span class="at">fit.y =</span> fit.y, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="binary-mediator" class="level1">
<h1>binary mediator</h1>
<section id="cfdecomp-1" class="level2">
<h2 class="anchored" data-anchor-id="cfdecomp-1"><code>cfdecomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cfd.mean</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b <span class="ot">&lt;-</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cfd.mean</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.y =</span> <span class="st">'Y ~ X + T2 + X:T2 + L1 + L2 + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula.m =</span> <span class="st">'T2 ~ X + C1 + C2 + C3 + C4'</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediator =</span> <span class="st">'T2'</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">'X'</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.y =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family.m =</span> <span class="st">'binomial'</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">bs.size =</span> <span class="dv">50</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.size =</span> <span class="dv">10</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8981701</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5546351</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"4"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"4"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.343535</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_cfdecomp_b<span class="sc">$</span>mediation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        4         2         3 
0.3828971 0.1298177 0.2061071 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2774845</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2419289</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"2"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"2"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.03555558</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5849521</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4655888</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fit_cfdecomp_b<span class="sc">$</span>out_nc_y[,<span class="st">"3"</span>] <span class="sc">-</span> fit_cfdecomp_b<span class="sc">$</span>out_cf_y[,<span class="st">"3"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1193632</code></pre>
</div>
</div>
</section>
<section id="causal.decomp-1" class="level2">
<h2 class="anchored" data-anchor-id="causal.decomp-1"><code>causal.decomp</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smi</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fit.y <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> T2 <span class="sc">+</span> X<span class="sc">:</span>T2 <span class="sc">+</span> L1 <span class="sc">+</span> L2 <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>fit_smi_b <span class="ot">&lt;-</span> <span class="fu">smi</span>(<span class="at">fit.y =</span> fit.y,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fit.m =</span> fit.m,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">treat =</span> <span class="st">"X"</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">sims =</span> <span class="dv">100</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">conf.level =</span> .<span class="dv">95</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">conditional =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>               <span class="co"># covariates = 1,</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>),</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">seed =</span> <span class="dv">123456</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>fit_smi_b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results:

                                estimate 95% CI Lower 95% CI Upper
Initial Disparity   (1 vs 4) -0.95667843  -1.02938841  -0.88175003
Disparity Remaining (1 vs 4) -0.61262729  -0.77966809  -0.46844380
Disparity Reduction (1 vs 4) -0.34405113  -0.49650368  -0.21581205
Initial Disparity   (1 vs 2) -0.31394841  -0.38058533  -0.26000373
Disparity Remaining (1 vs 2) -0.27995004  -0.34624791  -0.22226331
Disparity Reduction (1 vs 2) -0.03399837  -0.05003528  -0.02022012
Initial Disparity   (1 vs 3) -0.59968604  -0.69525994  -0.49987857
Disparity Remaining (1 vs 3) -0.48148718  -0.61387973  -0.32105036
Disparity Reduction (1 vs 3) -0.11819886  -0.24676548  -0.03361808</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sensRes <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">boot.res =</span> fit_smi_b, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.m =</span> fit.m, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.y =</span> fit.y, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mediator =</span> <span class="st">"T2"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="st">"X"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sel.lev.treat =</span> <span class="st">"4"</span>, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max.rsq =</span> <span class="fl">0.3</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sensRes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gapclosing" class="level2">
<h2 class="anchored" data-anchor-id="gapclosing"><code>gapclosing</code></h2>
<ul>
<li><span class="citation" data-cites="Lundberg2022a">Lundberg (<a href="#ref-Lundberg2022a" role="doc-biblioref">2022</a>)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - regression</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stochastic intervention</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># treatmentの割り当て確率の予測値を算出</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3, <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 全員のtreatmentが1だった時の予測値</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>assing_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_glm, <span class="at">newdata =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">X =</span> <span class="st">"1"</span>), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値をもとにrandom draw</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>draw <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>fit_gapclosing <span class="ot">&lt;-</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">*</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">counterfactual_assignments =</span> draw <span class="co"># random draw</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>機械学習をつかったdoubly robustな方法も使える</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gapclosing - ranger, doubly robust</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fit_gapclosing_ranger <span class="ot">&lt;-</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gapclosing</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">T2 =</span> <span class="fu">as.numeric</span>(T2) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_formula =</span> Y <span class="sc">~</span> T2 <span class="sc">+</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_formula =</span> T2 <span class="sc">~</span> X <span class="sc">+</span> C1 <span class="sc">+</span> C2 <span class="sc">+</span> C3 <span class="sc">+</span> C4 <span class="sc">+</span> L1 <span class="sc">+</span> L2, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_name =</span> <span class="st">"T2"</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome_algorithm =</span> <span class="st">"ranger"</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">category_name =</span> <span class="st">"X"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">counterfactual_assignments =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(d), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> assing_prob) </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>fit_gapclosing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factual mean outcomes:
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         6.70
3 2         7.32
4 3         6.98

Counterfactual mean outcomes (post-intervention means):
# A tibble: 4 × 2
  X     estimate
  &lt;fct&gt;    &lt;dbl&gt;
1 1         7.60
2 4         7.03
3 2         7.36
4 3         7.11

Factual disparities:
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.899
 2 1 - 2    0.275
 3 1 - 3    0.614
 4 4 - 1   -0.899
 5 4 - 2   -0.624
 6 4 - 3   -0.286
 7 2 - 1   -0.275
 8 2 - 4    0.624
 9 2 - 3    0.339
10 3 - 1   -0.614
11 3 - 4    0.286
12 3 - 2   -0.339

Counterfactual disparities (gap-closing estimands):
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.566 
 2 1 - 2   0.241 
 3 1 - 3   0.483 
 4 4 - 1  -0.566 
 5 4 - 2  -0.325 
 6 4 - 3  -0.0830
 7 2 - 1  -0.241 
 8 2 - 4   0.325 
 9 2 - 3   0.242 
10 3 - 1  -0.483 
11 3 - 4   0.0830
12 3 - 2  -0.242 

Additive gap closed: Counterfactual - Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4   0.334 
 2 1 - 2   0.0339
 3 1 - 3   0.131 
 4 4 - 1  -0.334 
 5 4 - 2  -0.300 
 6 4 - 3  -0.203 
 7 2 - 1  -0.0339
 8 2 - 4   0.300 
 9 2 - 3   0.0972
10 3 - 1  -0.131 
11 3 - 4   0.203 
12 3 - 2  -0.0972

Proportional gap closed: (Counterfactual - Factual) / Factual
# A tibble: 12 × 2
   X     estimate
   &lt;chr&gt;    &lt;dbl&gt;
 1 1 - 4    0.371
 2 1 - 2    0.123
 3 1 - 3    0.214
 4 4 - 1    0.371
 5 4 - 2    0.480
 6 4 - 3    0.710
 7 2 - 1    0.123
 8 2 - 4    0.480
 9 2 - 3    0.287
10 3 - 1    0.214
11 3 - 4    0.710
12 3 - 2    0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disparityplot</span>(fit_gapclosing_ranger, <span class="at">category_A =</span> <span class="st">"1"</span>, <span class="at">category_B =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Causal_Decomposition_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Lundberg2022a" class="csl-entry" role="listitem">
Lundberg, Ian. 2022. <span>“The <span>Gap-Closing Estimand</span>: <span>A Causal Approach</span> to <span>Study Interventions That Close Disparities Across Social Categories</span>.”</span> <em>Sociological Methods &amp; Research</em>, January. <a href="https://doi.org/10.1177/00491241211055769">https://doi.org/10.1177/00491241211055769</a>.
</div>
<div id="ref-Park2023" class="csl-entry" role="listitem">
Park, Soojin, Suyeon Kang, Chioun Lee, and Shujie Ma. 2023. <span>“Sensitivity <span>Analysis</span> for <span>Causal Decomposition Analysis</span>: <span>Assessing Robustness Toward Omitted Variable Bias</span>.”</span> <em>Journal of Causal Inference</em> 11 (1). <a href="https://doi.org/10.1515/jci-2022-0031">https://doi.org/10.1515/jci-2022-0031</a>.
</div>
<div id="ref-Sudharsanan2021" class="csl-entry" role="listitem">
Sudharsanan, Nikkil, and Maarten J Bijlsma. 2021. <span>“Educational <span>Note</span>: <span>Causal Decomposition</span> of <span>Population Health Differences Using Monte Carlo Integration</span> and the <span>G-Formula</span>.”</span> <em>International Journal of Epidemiology</em> 50 (6): 2098–2107. <a href="https://doi.org/10.1093/ije/dyab090">https://doi.org/10.1093/ije/dyab090</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/Kentaro-Kamada\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>